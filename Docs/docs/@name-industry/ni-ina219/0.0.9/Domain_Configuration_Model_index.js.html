<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Domain/Configuration/Model/index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseRegisterModel.html">BaseRegisterModel</a><ul class='methods'><li data-type='method'><a href="BaseRegisterModel.html#.formatData#formatData">formatData</a></li><li data-type='method'><a href="BaseRegisterModel.html#.getCurrentValues#getCurrentValues">getCurrentValues</a></li><li data-type='method'><a href="BaseRegisterModel.html#.getCurrentValues#getCurrentValues">getCurrentValues</a></li><li data-type='method'><a href="BaseRegisterModel.html#.hydrate#hydrate">hydrate</a></li></ul></li><li><a href="BusVoltage.html">BusVoltage</a></li><li><a href="BusVoltageModel.html">BusVoltageModel</a><ul class='methods'><li data-type='method'><a href="BusVoltageModel.html#.calculateValue#calculateValue">calculateValue</a></li></ul></li><li><a href="Calibration.html">Calibration</a><ul class='methods'><li data-type='method'><a href="Calibration.html#.getCalculationValues#getCalculationValues">getCalculationValues</a></li><li data-type='method'><a href="Calibration.html#.getCalibration#getCalibration">getCalibration</a></li><li data-type='method'><a href="Calibration.html#.setCalibrationByTemplate#setCalibrationByTemplate">setCalibrationByTemplate</a></li><li data-type='method'><a href="Calibration.html#.setCustomCalibration#setCustomCalibration">setCustomCalibration</a></li><li data-type='method'><a href="Calibration.html#.triggerCalibration#triggerCalibration">triggerCalibration</a></li></ul></li><li><a href="CalibrationModel.html">CalibrationModel</a><ul class='methods'><li data-type='method'><a href="CalibrationModel.html#.getCalibrationValues#getCalibrationValues">getCalibrationValues</a></li><li data-type='method'><a href="CalibrationModel.html#.setActiveTemplate#setActiveTemplate">setActiveTemplate</a></li><li data-type='method'><a href="CalibrationModel.html#.setCustomCalibrationValues#setCustomCalibrationValues">setCustomCalibrationValues</a></li></ul></li><li><a href="ChargeRemainingModel.html">ChargeRemainingModel</a><ul class='methods'><li data-type='method'><a href="ChargeRemainingModel.html#.calculateValue#calculateValue">calculateValue</a></li><li data-type='method'><a href="ChargeRemainingModel.html#.formatData#formatData">formatData</a></li></ul></li><li><a href="Configuration.html">Configuration</a><ul class='methods'><li data-type='method'><a href="Configuration.html#.getConfiguration#getConfiguration">getConfiguration</a></li><li data-type='method'><a href="Configuration.html#.setConfiguration#setConfiguration">setConfiguration</a></li><li data-type='method'><a href="Configuration.html#.setConfigurationBADC#setConfigurationBADC">setConfigurationBADC</a></li><li data-type='method'><a href="Configuration.html#.setConfigurationByTemplate#setConfigurationByTemplate">setConfigurationByTemplate</a></li><li data-type='method'><a href="Configuration.html#.setConfigurationMode#setConfigurationMode">setConfigurationMode</a></li><li data-type='method'><a href="Configuration.html#.setConfigurationMode#setConfigurationMode">setConfigurationMode</a></li><li data-type='method'><a href="Configuration.html#.setConfigurationPGA#setConfigurationPGA">setConfigurationPGA</a></li><li data-type='method'><a href="Configuration.html#.setConfigurationSADC#setConfigurationSADC">setConfigurationSADC</a></li></ul></li><li><a href="ConfigurationModel.html">ConfigurationModel</a><ul class='methods'><li data-type='method'><a href="ConfigurationModel.html#.editConfigurationBADC#editConfigurationBADC">editConfigurationBADC</a></li><li data-type='method'><a href="ConfigurationModel.html#.editConfigurationBRNG#editConfigurationBRNG">editConfigurationBRNG</a></li><li data-type='method'><a href="ConfigurationModel.html#.editConfigurationMode#editConfigurationMode">editConfigurationMode</a></li><li data-type='method'><a href="ConfigurationModel.html#.editConfigurationPGain#editConfigurationPGain">editConfigurationPGain</a></li><li data-type='method'><a href="ConfigurationModel.html#.editConfigurationSADC#editConfigurationSADC">editConfigurationSADC</a></li><li data-type='method'><a href="ConfigurationModel.html#.getCurrentConfiguration#getCurrentConfiguration">getCurrentConfiguration</a></li><li data-type='method'><a href="ConfigurationModel.html#.setActiveTemplate#setActiveTemplate">setActiveTemplate</a></li></ul></li><li><a href="Current.html">Current</a></li><li><a href="CurrentModel.html">CurrentModel</a><ul class='methods'><li data-type='method'><a href="CurrentModel.html#.calculateValue#calculateValue">calculateValue</a></li></ul></li><li><a href="Device.html">Device</a><ul class='methods'><li data-type='method'><a href="Device.html#.getDeviceInformation#getDeviceInformation">getDeviceInformation</a></li><li data-type='method'><a href="Device.html#.initialize#initialize">initialize</a></li></ul></li><li><a href="I2cBus.html">I2cBus</a><ul class='methods'><li data-type='method'><a href="I2cBus.html#.getConnectedDevices#getConnectedDevices">getConnectedDevices</a></li><li data-type='method'><a href="I2cBus.html#.initialize#initialize">initialize</a></li><li data-type='method'><a href="I2cBus.html#.readRegister#readRegister">readRegister</a></li><li data-type='method'><a href="I2cBus.html#.updateState#updateState">updateState</a></li><li data-type='method'><a href="I2cBus.html#.writeRegister#writeRegister">writeRegister</a></li></ul></li><li><a href="NI_INA219.html">NI_INA219</a><ul class='methods'><li data-type='method'><a href="NI_INA219.html#.getBusVoltage#getBusVoltage">getBusVoltage</a></li><li data-type='method'><a href="NI_INA219.html#.getCalibration#getCalibration">getCalibration</a></li><li data-type='method'><a href="NI_INA219.html#.getChargeRemaining#getChargeRemaining">getChargeRemaining</a></li><li data-type='method'><a href="NI_INA219.html#.getConfiguration#getConfiguration">getConfiguration</a></li><li data-type='method'><a href="NI_INA219.html#.getCurrent#getCurrent">getCurrent</a></li><li data-type='method'><a href="NI_INA219.html#.getDeviceInformation#getDeviceInformation">getDeviceInformation</a></li><li data-type='method'><a href="NI_INA219.html#.getPower#getPower">getPower</a></li><li data-type='method'><a href="NI_INA219.html#.getPowerSupplyVoltage#getPowerSupplyVoltage">getPowerSupplyVoltage</a></li><li data-type='method'><a href="NI_INA219.html#.getShuntVoltage#getShuntVoltage">getShuntVoltage</a></li><li data-type='method'><a href="NI_INA219.html#.initialize#initialize">initialize</a></li><li data-type='method'><a href="NI_INA219.html#.setConfigurationByTemplateId#setConfigurationByTemplateId">setConfigurationByTemplateId</a></li></ul></li><li><a href="Power.html">Power</a></li><li><a href="PowerModel.html">PowerModel</a><ul class='methods'><li data-type='method'><a href="PowerModel.html#.calculateValue#calculateValue">calculateValue</a></li></ul></li><li><a href="PowerSupplyModel.html">PowerSupplyModel</a><ul class='methods'><li data-type='method'><a href="PowerSupplyModel.html#.calculateValue#calculateValue">calculateValue</a></li><li data-type='method'><a href="PowerSupplyModel.html#.formatData#formatData">formatData</a></li></ul></li><li><a href="ShuntVoltage.html">ShuntVoltage</a></li><li><a href="ShuntVoltageModel.html">ShuntVoltageModel</a><ul class='methods'><li data-type='method'><a href="ShuntVoltageModel.html#.calculateValue#calculateValue">calculateValue</a></li></ul></li><li><a href="Utilities.html">Utilities</a><ul class='methods'><li data-type='method'><a href="Utilities.html#.mappedLabelsAndBits#mappedLabelsAndBits">mappedLabelsAndBits</a></li><li data-type='method'><a href="Utilities.html#.registerAsBinaryString#registerAsBinaryString">registerAsBinaryString</a></li></ul></li><li><a href="WSchargeRemaining.html">WSchargeRemaining</a></li><li><a href="WSpowerSupplyVoltage.html">WSpowerSupplyVoltage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#TEMPLATES">TEMPLATES</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">Domain/Configuration/Model/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class ConfigurationModel
 * 
 * @summary
 * CONFIGURATION REGISTER: PDF REF: Figure 19 pg. 19
 * @description
 * BIT 15: Reset Bit&lt;br /> 
 *  Set to 1 generates a system reset that is the same as power-on reset
 *  auto-clears.
 * &lt;br />&lt;br />
 * BIT 13: Bus Voltage Range&lt;br />
 *  0 = 16V FSR&lt;br />
 *  1 = 32V FSR
 * &lt;br />&lt;br />
 * BIT 11, 12: PGA (Shunt Voltage Only)&lt;br />
 *  default is +8 (320mV range) see PDF pg.19 Table 4. PG Bit Settings
 * &lt;br />&lt;br />
 * BIT 7-10: BADC Bus ADC resolution/averaging&lt;br />
 *  sets the number of samples used when averaging results for the 
 *  Bus Voltage Register
 *&lt;br />&lt;br />
 * BIT 3-6: SADC Bus ADC resolution/averaging&lt;br />
 *  sets the number of samples used when averaging results for the 
 *  Shunt Voltage Register
 * &lt;br />&lt;br />
 * BIT 0-2: Operating Mode&lt;br />
 *  defaults to continuous shunt and bus measurement mode 
 * 
 */
import BaseRegisterModel from "../../BaseModels/BaseRegisterModel.js";

class ConfigurationModel extends BaseRegisterModel {

    /** @type {object | undefined} */
    activeTemplate;

    constructor() {
        super("Configuration");
    }

    /**
     * @type {object}
     * 
     * @summary
     * If useFullReturn is true then the labels are added to the return
     * object. 
     * 
     * @description
     * These are labels the directly match the reference sensor PDF doc. When
     * debugging or in case UI desires it, arrays of labels and bits in the 
     * register will be matched.
     */
    bitLabels = [
        'RST',
        '-',
        'BRNG',
        'PG1', 'PG0',
        'BADC4', 'BADC3', 'BADC2', 'BADC1',
        'SADC4', 'SADC3', 'SADC2', 'SADC1',
        'MODE3', 'MODE2', 'MODE1'
    ];

    /**
     * @method ConfigurationModel#setActiveTemplate
     * 
     * @summary
     * Sets active Template 
     * 
     * @description
     * Set the active template internally if using templates.
     * 
     * @param {number} newActiveTemplate 
     * @returns {object} activeTemplate
     */
     setActiveTemplate = function (template) {
        if (template !== undefined) {
            this.activeTemplate = template;
        } else {
            this.activeTemplate = undefined; // unset
        }
        return this.activeTemplate || {}
    }

    mapConfigurationToValues = function () {
        let configurationRegisterAsDecimal = this.currentConfiguration;
        // we want FSR 16V or 32V bit 13 0 === 16 1 === 32
        let BRNG = 32;
    }

    /**
     * @method ConfigurationModel#getCurrentConfiguration
     * 
     * @summary
     * Gets the currant live Configuration
     * 
     * @description
     * Gets the value of the current live COnfiguration register. This is cached
     * and updated only on change ( write ) of register.
     * 
     * @returns {number} configuration as an int
     */
    getCurrentConfiguration = function () {
        return this.currentConfiguration;
    }

    /**
     * @method ConfigurationModel#editConfigurationMode
     * 
     * @summary
     * Edit mode bits in configuration register
     * 
     * @description
     * Heavy handed way to open up MODES in the configuration register
     * by calculating a new config for the last 3 bits [x x x x x 2 1 0]
     * Takes an oldConfiguration decimal value - stored in the main class
     * after initializing or setting a new configuration by template.
     * 
     * Returns the new config decimal for use in writing the new config to
     * the register
     * 
     * @param {int} oldConfiguration the decimal value of the configuration register 
     * @param {string} mode the name of the mode in the Constants file
     * @returns {number}  returns new config register as base 10 
     */
    editConfigurationMode = function (oldConfiguration, mode) {
        let modeHexValue = Constants.CONFIGURATION.MODE[mode];
        let newConfigBits = ((oldConfiguration >>> modeHexValue) &lt;&lt; modeHexValue) | modeHexValue;
        return newConfigBits;
    }

    /**
     * @method ConfigurationModel#editConfigurationBRNG
     * 
     * @summary
     * Edit Bus-Voltage-Range bit in configuration register
     * 
     * @description
     * Edit voltage amount in configuration calculating a new config for 
     * the bit 13  [ x - 13 x, x x x x | x x x x, x x x x]
     * Takes an oldConfiguration decimal value - stored in the main class
     * after initializing or setting a new configuration by template.
     * 
     * only 2 values in ina219 -> 16V and 32V
     * 
     * Returns the new config decimal for use in writing the new config to
     * the register
     * 
     * accepts:
     * "RANGE_16V": 0x00
     * "RANGE_32V": 0x01 
     * 
     * @param {int} oldConfiguration the decimal value of the configuration register 
     * @param {string} mode the name of the bus voltage range key in the Constants file
     * @returns {number}  returns new config register as base 10 
     */
    editConfigurationBRNG = function (oldConfiguration, range) {
        // mask and clear the bit
        let mask = ~(1 &lt;&lt; 13);
        let clearedOldConfiguration = oldConfiguration &amp; mask;
        // set new value to that bit
        let rangeHexValue = Constants.CONFIGURATION.BUS_VOLTAGE_RANGE[range];
        let newConfigBits = clearedOldConfiguration | (rangeHexValue &lt;&lt; 13);
        return newConfigBits;
    }

    /**
     * @method ConfigurationModel#editConfigurationPGain
     * 
     * @summary
     * Edit PG-Gain bits in configuration register
     * 
     * @description
     * PGA (Shunt Voltage Only)
     * Edit PGA gain and range amount in configuration. 
     * The bits 11 -> 12  [ x - x 12, 11 x x x | x x x x, x x x x]
     * Takes an oldConfiguration decimal value - stored in the main class
     * after initializing or setting a new configuration by template.
     * 
     * Returns the new config decimal for use in writing the new config to
     * the register
     * 
     * accepts:
     * "RANGE_16V": 0x00
     * "RANGE_32V": 0x01 
     * 
     * @param {int} oldConfiguration the decimal value of the configuration register 
     * @param {string} gain the name of the GAIN key in the Constants file
     * @returns {number}  returns new config register as base 10 
     */
    editConfigurationPGain = function (oldConfiguration, gain) {
        // mask and clear the bits
        let mask = (1 &lt;&lt; 2) - 1;
        let clearedOldConfiguration = oldConfiguration &amp; ~(mask &lt;&lt; 11);
        // set new value to that bit
        let gainHexValue = Constants.CONFIGURATION.GAIN[gain];
        let newConfigBits = clearedOldConfiguration | (gainHexValue &lt;&lt; 11);
        return newConfigBits;
    }

    /**
     * @method ConfigurationModel#editConfigurationBADC
     * 
     * @summary
     * Edit Bus ADC bits in configuration register
     * 
     * @description
     * Edit Bus ADC Resolution/Averaging amount in the configuration
     * register. 
     * The bits 7 -> 10  [ x - x x, x 10 9 8 | 7 x x x, x x x x]
     * Takes an oldConfiguration decimal value - stored in the main class
     * after initializing or setting a new configuration by template.
     * 
     * Returns the new config decimal for use in writing the new config to
     * the register
     * 
     * @param {int} oldConfiguration the decimal value of the configuration register 
     * @param {string} bADCConstant the name of the BUS_ADC_RESOLUTION key in the Constants file
     * @returns {number}  returns new config register as base 10 
     */
    editConfigurationBADC = function (oldConfiguration, bADCConstant) {
        // mask and clear the bits
        let mask = (1 &lt;&lt; 4) - 1;
        let clearedOldConfiguration = oldConfiguration &amp; ~(mask &lt;&lt; 7);
        // set new value to that bit
        let bADCHexValue = Constants.CONFIGURATION.BUS_ADC_RESOLUTION[bADCConstant];
        let newConfigBits = clearedOldConfiguration | (bADCHexValue &lt;&lt; 7);
        return newConfigBits;
    }

    /**
     * @method ConfigurationModel#editConfigurationSADC
     * 
     * @summary
     * Edit Shunt ADC bits in configuration register
     * 
     * @description
     * Edit Shunt ADC Resolution/Averaging amount in the configuration
     * register. 
     * The bits 3 -> 6  [ x - x x, x x x x | x 6 5 4, 3 x x x]
     * Takes an oldConfiguration decimal value - stored in the main class
     * after initializing or setting a new configuration by template.
     * 
     * Returns the new config decimal for use in writing the new config to
     * the register
     * 
     * @param {int} oldConfiguration the decimal value of the configuration register 
     * @param {string} sADCConstant the name of the SHUNT_ADC_RESOLUTION key in the Constants file
     * @returns {number}  returns new config register as base 10 
     */
    editConfigurationSADC = function (oldConfiguration, sADCConstant) {
        // mask and clear the bits
        let mask = (1 &lt;&lt; 4) - 1;
        let clearedOldConfiguration = oldConfiguration &amp; ~(mask &lt;&lt; 3);
        // set new value to that bit
        let sADCHexValue = Constants.CONFIGURATION.SHUNT_ADC_RESOLUTION[sADCConstant];
        let newConfigBits = clearedOldConfiguration | (sADCHexValue &lt;&lt; 3);
        return newConfigBits;
    }

}

export default new ConfigurationModel();</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Sat Dec 03 2022 18:09:20 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
